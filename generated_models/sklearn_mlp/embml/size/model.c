#include <stdlib.h>
#include <stdint.h>
#include <math.h>


#define NUM_CLASSES 6
#define INPUT_SIZE 128
#define N_LAYERS 4
#define N_NEURONS 145
#define my_abs(x) (((x) > (0.0)) ? (x) : -(x))

float instance[INPUT_SIZE + 1];

float buffer1[128];
float buffer2[6];
const uint8_t sizes[N_LAYERS] = {128, 5, 6, 6};

const float *coefs[N_LAYERS - 1];

const float coefs_0[5 * 128] = {0.11498507475308087, -0.6190822913929821, -0.16896993861320456, -0.2486524139063471, 0.3377627658091173, -0.05525120447364273, -0.22398150421792612, -0.007325673190264523, -0.7748402824714119, -0.4147041147915018, -1.395617670588507, -1.5278250946211196, -0.22011152739394402, 0.43217332643550194, 0.1439523460541206, 0.2346197779244212, -0.3354853049925307, 0.026919647888421612, -0.3338770581309729, 0.043233215265007265, -0.1762989642293212, 0.018460164375283406, -0.5121075040949552, 0.9459434083102471, -0.7404091909353758, 0.004688576485414399, -0.18309143452561838, 0.5063322124725945, 0.30636129180626964, -0.3449455235194585, -0.304418162030007, 0.24023380265458433, -0.5587505694461885, 0.35234986667832857, -0.2155614100164479, 0.04937505657359885, -0.1875210591465972, 0.1703345913233856, 0.02596584096239498, 0.48449602903795386, 0.07176432921767982, 0.009859137560318454, 0.08709814520211856, 0.4524834268574271, -0.05253442723370023, -0.29412522217373294, -0.11996520303466722, 0.6185715190166075, -0.7401848038701208, 0.015584569712796712, -0.23809253462403537, 0.8660840955416511, 0.4638489359914851, -0.2270584846973326, -0.3268987981606014, 0.07826298482501143, -0.5600134075375659, 0.1768166308049841, -0.11836424887834761, 0.36068381793851234, 0.262247954993147, -0.11002934031713832, -0.16441058488051755, -0.5086094851022783, -0.5287669974856998, -0.17184319633613115, -0.8399720520952653, -0.9520423887789098, 0.3953995132880251, 0.40012736242498265, 0.5169105747170332, 0.3874515075998511, 0.9158323698287378, 1.1586185986202706, 0.46300633960599014, 0.3079294669272168, 0.48901185897027566, -1.1948774865219502, -0.8384145670019827, 0.2141479501955045, -0.32090792884746877, -0.2165457410895934, -0.3631890029562678, 0.4832925373966986, -0.688297221538872, -0.0057160939132208655, 0.19313774890680982, 0.334716063962828, -0.6067515143846522, -0.006613302807398495, -0.4006082441455342, 0.7323945693926072, -0.9860024129294885, -0.0028063565286773782, 0.25081369490797223, -0.2255916002278479, -0.169488727076042, 0.8832521206592017, 0.3984340049901011, 0.703408546849627, -0.11367571355397472, -0.7747814998442775, -0.17255276865480257, 0.7416392293369125, -0.23716913713766097, 0.20253601692037823, -0.11098309641621096, 0.06422346984732251, -0.30293211690300864, -0.8950981069577314, -0.42441408782664497, 0.429700903905435, -0.751494063536083, 0.5180892042850593, 0.26267281221184235, 1.3675629511357872, 0.8382662960782241, 0.028957050193735845, -0.20013214520754033, 0.016113809734624576, -0.6217764976590235, 0.5930099243827188, 0.1608810582722536, 1.4819581382534042, 0.5057945342657725, -0.1112065678476089, -0.18667019655799122, 0.28594797919503645, -0.06002115464914985, -0.0015160093686795864, -0.37791917204521697, -0.5550871787962827, -0.39312452582340845, -0.0071245200518103334, 0.10137375707427933, 0.39961239933657833, 1.0612398917470578, 0.38674822294443995, 0.6668304332797385, 0.39515762513466357, 0.010392590578064603, -0.6608450125389996, -0.6529609592843778, 0.12273433188055743, 0.2725362221903877, -0.42591563299977653, -0.17797266269024697, -0.1880044277703237, 0.017392714884379153, -0.11511186550518036, 0.03006304409775086, 0.12399010292876553, -0.07407687056239423, -0.4744421124739966, -0.2510706092246282, -0.3365849234645068, -0.2820741400167126, 0.02228832232624129, 0.36899892653874394, -0.016138470427640102, 0.3333318999309172, -0.5545037281350292, 0.24295102025179705, 0.1919967309642987, -0.199976715433328, -0.052100201107368835, -0.179538946531723, -0.2432446345602324, 0.1419769720282527, 0.029254119823341435, 0.11339228421895624, -0.12865419047835214, -0.12209209844291201, 0.3763336409802009, 0.26798502953254344, -0.3636702771159147, 0.8792225127396731, -0.2187947008201757, 0.19513316975357534, -0.3010231855123253, -0.046002020261354123, -0.13183038210794495, -0.23376408753442443, -0.3655690258714596, 0.8324773837850171, -0.010168587217284919, 0.055771666219699985, -0.38750802032338594, -0.005572523695530385, -0.2553072534043212, 0.03563799166552694, -0.17936546330652797, 0.6673980437941526, 0.2937136227227606, 0.364118840270245, -0.018573521628190086, 0.153842996428633, -0.35249808503142904, -0.15860410020590815, 0.29014394852272046, 0.17587574678110252, 0.5042405961410843, -0.3165425574425271, -0.14199501452068167, -0.4936164835710775, -0.15363763384580223, -0.037319866520308574, 0.10678084632494367, 0.6967520038384682, -0.11854745626055889, -0.044588074253338945, -0.32804240912732485, -0.5974132160411114, -0.32876035643041657, -0.05744610096644592, 0.3564680880409419, 0.061801391956219365, -0.1456024197708865, -0.24861379021480395, -0.4456017253951567, -0.4458031748082256, 0.24527373910352415, 0.046357418525686145, 0.4411183584122342, 0.7289636420260229, -0.9905498123835843, 0.4939480109444743, 0.667085155794557, -0.1582260908590309, 0.08675318285410835, -0.03894299776632311, 0.19914367492104953, 0.4916629795836074, -1.1338052503199463, 0.16648514177174256, 0.5159385930396199, 0.07085680421709996, 0.06648747380201163, 0.057703982467307825, 0.10970863889512805, 0.9200002327559266, 0.015083677794933675, 0.24824573326354293, -0.5380433273109836, -0.4936435152691181, -0.16646678425925038, 0.0062759604854067536, -0.06398694022936463, 1.032498735203704, 0.05302531895342564, 0.36041296345140317, -0.5095904053003799, -0.2595174814870436, -0.2593371806241442, -0.017551595975728407, 0.1621644702508654, 0.6651655560320544, 0.014206465918745411, 0.5638710317186071, 0.17746374002291848, 0.04758443662265649, 0.1473666303840203, 0.4400106785117859, 0.23340880016935173, 2.205812196203997, 0.3115329715661603, 1.7726599587207381, 0.4056343950543574, 0.1627796906682318, 0.09797384205848518, 0.36738900626388127, -1.2060472191557683, 0.3895734217411679, 0.3288942692566677, 0.03903933365159995, -0.4074126258381568, 0.1787606073617595, -0.24517352479183457, 0.2146938637505062, -0.31117575329995706, 0.005000885459132911, 0.007827421157028487, 0.16030788993703024, -0.3940684527875569, -0.07794774033914979, -0.40603546478983865, -0.04155006555568443, -0.047078769320626136, 0.19039223458105048, -0.7138620079630363, 1.5069745263647156, -1.044523445279941, 0.26152780643157775, 1.0986177065062679, 0.379328153040507, -0.32991291357880775, 0.7629721622476004, 0.002818285735576387, 0.9910153285593822, -1.1883956225725958, 0.26203834519919705, 1.0785210333556112, 0.06971513044714639, -0.3010539297593763, 0.2751342035393274, -0.0728938152109833, -0.11330163270953553, -0.7610041748629036, -0.75405466811314, -0.054372390090881996, 0.1977263414383795, 0.13109460049252689, 0.2531394062715641, 0.09940665843764757, -0.0980816388134038, -1.0702652003829256, -0.24453738147421952, -0.005545306478813209, -0.08607801594406461, -0.6408975846735095, -0.13969660177538035, 0.08162370276726526, 0.16851180357725135, 0.3386162016574917, 0.49095340034011153, 0.7873783674862317, 0.0043453109764445405, -1.0532763139326242, -0.8119460719463446, -0.09970992561605303, -1.0056698196380824, -0.7872324621142511, -0.1316655680230033, 0.8289253194924728, 0.1840739593228095, -0.24572862563183354, -0.6049262419478044, 0.20458485290651748, -0.05640698086273404, -0.5258360715391851, 0.22364327364681702, -0.18660321071066402, -0.04229787207231346, 0.44366914228326015, -0.09941045616092438, 0.07167086064156787, 0.05417701884025306, -0.4783881715857115, 0.8343931684905652, -0.2892443609583078, 0.040904345044519785, 0.033851578378728826, 0.5517976331868092, -0.7144279995482028, 0.8249942304181263, -1.327911870751162, 0.06642382149909702, 0.4154141270623496, 0.45344499765084295, -0.11189396122544572, 1.1444508820139196, -0.5820534714074493, 0.9373660293060453, -1.3135867365501166, 0.06965264979402516, 0.14436196855793257, 0.3845997089102164, -0.002886049308307659, -0.049797931626733634, 0.04772296721458811, 0.27601981943555925, -0.1944282570432967, 0.2810503641866487, -0.40830216052980006, -0.37276498355921217, -0.48127212807884623, -0.43763599121803903, -0.3500451829564905, -0.1464269292477123, -0.7238182908126723, -0.3026619180235423, -0.0028336237724268585, 0.1726940093887689, 0.5759333327850402, -0.1208636626089104, 0.6740624616745501, 0.1429971858481421, 0.21962527865916326, -0.06105311309276167, -0.4075072718321094, 0.3435666315509691, 0.40599696356410897, -0.2650023518479373, 0.4454055247687698, 0.44125969243577057, 1.082496526827787, -0.067097654804181, -0.06883370587608145, 0.5286531254751167, 0.658508162405285, -0.8460408599358118, -1.083663798247814, -0.9058570422953491, -1.2320394435979618, 0.07631876982241965, 0.21833582373272467, 0.4373441049000201, 0.2092638692302905, -0.5311411756156109, -0.7395363966545866, -1.0785127171590467, -1.231936527539204, -0.40816408503225915, 0.2611103411146623, 0.01460885319337003, 0.33382892251917284, -0.07937293957110468, 0.3586749414014511, 0.8666465574504078, 0.5240821971663486, -0.6811505550456851, -0.5245894591343837, -0.09104765800878058, -0.41495942171616573, 0.1120971720103685, 0.2087220553378669, 0.35888645115588963, 0.03934552687006418, -1.030783998124112, 0.1551795566525432, -0.14050293613934234, 0.13755012765462454, -0.6819301109564898, 0.12546719678153648, -0.10984027416535785, -0.8686306500648654, -0.07817041612319459, -0.08162050097509413, 0.26830224884813964, -0.06570364400260174, -0.4483273609632937, 0.037909727673007015, -0.23870792046797892, -0.5105628282403238, 0.0030225357997441258, -0.13454225058961203, 0.03731003658779161, -0.7009419692842938, 0.14906800912670112, 1.2918846416679632, 0.20534057594494368, 0.8910736868609965, -0.3474707510541204, -1.1603588442132895, -0.3663376738757499, 0.7784107985930788, -0.5424090134390734, -0.38282782777723057, -0.7913527556558675, -0.3418212291940831, -0.8573126999090318, -0.2527364460694432, 0.3132637161762597, 0.6242347316555853, -0.6743629040905582, -1.6138397777194324, -0.7344556665753051, -1.285320985422159, 0.0842885982711825, 0.09437522291519107, 0.15633492633937737, 0.45244479712876523, 1.2116246814128575, 0.3471328176168172, 0.5753894146113822, -0.5849701631021262, 1.1669691156740716, -1.1043671225140148, -0.9685412090990195, -0.7115998842018277, 0.26836602434775786, 0.8279348154979023, 0.9915576067445621, 0.6185813555906238, -0.10433104779341697, -0.650043135330674, 0.013326451869483887, 0.49589714001881624, 0.4851713536290894, 1.1191310486862434, 1.9558112703684376, 0.9818608253738159, 0.2797366793219623, -0.4624029503366747, 0.02631937589857463, 0.04220865638723427, -0.5747057264835668, -1.012966693161274, -0.2054322400327015, -0.8872320490202825, -0.2973615791464531, -0.2799857045207174, 0.2802807276778858, 0.034564705592480184, 0.0800686044125776, -0.5836113220573753, -0.1742553737794644, -0.8476602608969785, 0.04199929262578185, -0.3586439887545191, 0.04101788559350579, 0.15458192451547687, -1.3887762412971905, -1.374159694468584, -0.03947907639777044, 0.3365300070152936, -0.1522723604916394, 0.28503172374948604, 0.018218877196173863, -0.27442241654940525, -1.2691975820416352, 0.053679820805321174, 0.25087319207225595, 0.8189794943427542, -0.2567950875980567, 0.389592576517297, 0.4007932407605454, -0.14708038768216483, -0.30236184113858516, 0.7215198246414913, 0.33234111460610977, -0.006957351094688142, -0.05632878491786111, 0.039757744923051605, 0.06276154096100735, -0.25250823770725095, 0.5010329901978304, 0.6794961031549211, 0.9849407600379457, -1.0332137985016647, -0.9982618842671324, -0.6941568405756384, -0.024258683291836024, 0.2993680054111112, -0.12975021470286768, 0.9613821698330617, 0.49520359103818834, -1.1409581475025212, 0.19529027962865286, -0.5630381254952336, -0.044008082834987076, 0.10091183565026761, -0.4563939162236088, -0.01912588130839444, 0.32988264554704, -1.1550265418143193, 0.06417918397426016, -0.6725838694033911, -0.11829154501740523, -0.35966253090726, -0.19527231739642817, 0.10949150716511198, 0.6399053971009547, -0.05186541406587419, 0.1815838261514843, -0.015231715847187657, 0.43000830946899965, 0.15295992820509624, -0.09283353944645506, -0.10001259062702683, 0.734444013572354, -0.1549890596390137, -0.2217557922771643, -0.20971388108171918, 0.03895999435576296, -0.05991477613829346, -1.3019919206431527, -1.084274011238911, -0.02314335383625271, 0.13948283443190101, -0.1148803865333203, -0.0410977960726756, -0.15955599448410546, -0.9513936220710558, -2.2364917304393512, -1.9082948235641997, -1.3506486346023499, -0.9523299592170731, -0.23255260776200745, 0.8991302152947124, 0.35992007833680956, -0.7260730379296387, -0.2922805447635648, 0.15688368788071425, 0.3489741495599015, -0.14406422273647232, 0.5464628765821284, 0.026578060723806342, 0.27136516010675793, 0.06223013686413761, 0.5485241916254578, 0.38418745591548537, 0.8334127625947859, 0.0007682237536360603, 0.9974532466294915, -0.7452025252506366, -0.2405483105997932, -0.20645848575910575, 0.07133637272737636, 1.6893910525565998, 0.553829422193357, -0.7900657070477294, 0.207330738040695, -0.8163962213146633, 0.2884744243498208, 0.70070266735026, 0.32336326960078715, 2.001463565284273, 1.198954409820154, -0.3964493264043448, 0.7294964415362436, -0.7846028237323122, -0.016284178139652078, -0.043334575451897, -0.38709948735420624, -0.9154407409323327, -0.09357313243531439, -0.9018009121224341, -0.5413808979051812, 0.22244199721903213, 0.33401430745875144, 0.0317335201591892, -0.5940386236961895, -0.5762716039889811, -0.3627664622227615, -0.945717284595756, -0.33251277733127504, 0.1315436723703845, 0.606933122003738, 0.10908264748189196};

const float coefs_1[6 * 5] = {-0.6986875006121281, -0.7416554798025687, -0.8145251386793815, -0.05282962769138025, -0.941450347082816, -1.204827765070434, 0.4580987443564464, 1.7256867095306576, 0.487084094255, 1.0951587904469597, -1.5254232115778341, -1.6652174487942968, 0.867071081128896, 1.4191224697674545, 1.3319639494598088, -0.34697845556449264, -0.150306597352939, -0.7438593414841543, 0.7917177281555349, -1.0457554789536228, -0.8703440236220057, -0.16674326748394588, -0.28374909269927723, -1.3906954883642468, 2.990811085836474, -2.8125481634256424, 0.09400340366195013, -0.7377103620082079, 1.5803293473777358, 1.8144592419102508};

const float coefs_2[6 * 6] = {1.0061146544205966, -1.23521218392857, -2.343478799101116, 2.6756202123300277, 0.9729979197577924, -1.192067761714407, 0.11090573228914095, 1.137420063610592, 0.09881977336547693, -1.1881144741084468, 1.4576502189895766, -1.664216667798203, 0.40557277277751935, 1.5492810569430278, 0.4813511238022653, -2.615382976313845, 0.3875997615792206, -0.17019034319646933, 0.06255227148774727, -2.705860583071082, -1.8403357673806309, 1.109955863872153, 0.41781829778729485, 2.8789994559402543, 0.09191202110435259, 2.061881589047917, 0.9110676353100434, 0.10312285650499596, 0.3711382185663999, -1.2310300222021353, -0.4042913186793287, -0.2604858192698063, 1.7148887529586319, -1.343008360036464, -3.690990709142327, 2.111584012676773};

const float *intercepts[N_LAYERS - 1];

const float intercepts_0[5] = {1.307436139874235, 1.2191806683943165, -0.6340986000748015, 1.0402325253764668, 2.3645184604152973};

const float intercepts_1[6] = {0.6200580873153234, -1.7691166759560228, -1.8780317758706289, 3.282106269446757, 1.992689293578456, 0.4990607814574451};

const float intercepts_2[6] = {3.430433604907742, 2.7892843274217785, -1.4158834168809793, -0.04394524018174149, -1.8967330850827013, -2.590483788943184};

const int8_t classes[NUM_CLASSES] = {0, 1, 2, 3, 4, 5};


float activation_hidden(float x){
	return max(0.0f, x);
}
float activation_output(float x, float max_elem){
	return (x - max_elem);
}
inline void forward_pass(const float *input, float *output, const float *coef, const float *intercept, const int inputSize, const int outputSize){
	int i = 0;
	for (int j = 0; j < outputSize; j++){
		float acc = 0.0;
		for (int k = 0; k < inputSize; k++){
			acc += (coef[i++] * input[k]);
		}
		output[j] = acc + intercept[j];
	}
}
int classify(){
	float *input = buffer1;
	float *output = buffer2;
	for (int i = 0; i < INPUT_SIZE; i++){
		input[i] = instance[i];
	}
	for (int i = 0; i < N_LAYERS - 1; i++){
		forward_pass(input, output, coefs[i], intercepts[i], sizes[i], sizes[i + 1]);
		if ((i + 1) != (N_LAYERS - 1)){
			for (int j = 0; j < sizes[i + 1]; j++){
				output[j] = activation_hidden(output[j]);
			}
			float *tmp = input;
			input = output;
			output = tmp;
		}
		else {
			float max_output = output[0];
			for (int j = 1; j < sizes[i + 1]; j++){
				if (output[j] > max_output){
					max_output = output[j];
				}
			}
			for (int j = 0; j < sizes[i + 1]; j++){
				output[j] = activation_output(output[j], max_output);
			}
		}
	}
	int indMax = 0;
	for (int i = 0; i < sizes[N_LAYERS - 1]; i++){
		if (output[i] > output[indMax]){
			indMax = i;
		}
	}
	return classes[indMax];
}

void initConnections(){
	coefs[0] = coefs_0;
	coefs[1] = coefs_1;
	coefs[2] = coefs_2;
	intercepts[0] = intercepts_0;
	intercepts[1] = intercepts_1;
	intercepts[2] = intercepts_2;
}


int main(void) {
    int result = classify();
    return result;
}
